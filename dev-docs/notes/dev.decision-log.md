---
id: lemvnlo09cw54zczwbgyhvw
title: Decision Log
desc: ''
updated: 1771779491637
created: 1771779490894
---

## Decision Log Template

- Decision:
- Owner:
- Date:
- Why:
- Tradeoffs:
- Follow-up tasks:

## Decisions (Locked for MVP)

### CLI Framework

- Decision: Use Deno standard-library argument parsing (`@std/cli`) with a small in-repo command router for `start`, `stop`, `status`, `clean`, and `export`. Do not add Cliffy in MVP.
- Owner: Kato engineering
- Date: 2026-02-22
- Why:
  - Command surface is small and stable for MVP.
  - Keeps dependency/supply-chain risk low and aligned with `dev.security-baseline` non-stdlib justification rules.
  - Supports strict command grammar defaults without framework indirection.
- Tradeoffs:
  - No autogenerated command help/completions from a full CLI framework.
  - We own basic usage text, validation, and command dispatch wiring.
- Follow-up tasks:
  - Add `apps/daemon/src/cli/` with parser + command router and tests.
  - Enforce fail-closed behavior for unknown commands/flags.
  - Re-evaluate Cliffy only if command surface/UX needs outgrow in-repo routing.
- MVP defaults:
  - Unknown command or unknown flag is a hard error.
  - No permissive alias behavior unless explicitly added.
  - Strict grammar remains default (legacy permissive parsing stays opt-in only).

### Logging Baseline

- Decision: Use an in-repo structured logger facade for MVP (no third-party logging package), with JSONL output and separate operational vs security-audit sinks.
- Owner: Kato engineering
- Date: 2026-02-22
- Why:
  - Aligns with `dev.security-baseline` requirement to separate security audit logs from operational logs.
  - Minimizes external dependencies while behavior is still being shaped.
  - Keeps local-first/no-network behavior simple and deterministic.
- Tradeoffs:
  - We forego advanced transport/rotation features from mature logging libraries.
  - We own a small amount of formatting/sink plumbing in daemon code.
- Follow-up tasks:
  - Add `apps/daemon/src/observability/logger.ts` and `apps/daemon/src/observability/audit_logger.ts`.
  - Define an event schema/version for log records.
  - Add redaction tests for sensitive fields and audit-completeness tests for allow/deny decisions.
- MVP defaults:
  - Format: JSONL.
  - Operational level: `info` (with `debug` opt-in).
  - Security audit events always write to dedicated audit log sink.
  - Operational and audit records remain separated by sink and schema.

### File Watching

- Decision: Use native `Deno.watchFs` with an in-repo debounce/settle utility. Do not use `chokidar`.
- Owner: Kato engineering
- Date: 2026-02-22
- Why:
  - `chokidar` is a heavy dependency with deep node-gyp/fsevents roots.
  - Deno's native watcher is sufficient for the MVP scope (local text files).
- Tradeoffs:
  - We must implement our own "write settling" logic (debounce) to handle editors that write via temp-rename or multiple flush events.
- Follow-up tasks:
  - Add `apps/daemon/src/core/watcher.ts` with debounce logic.

### Configuration & Parsing

- Decision:
  - Config: Use `zod` for schema validation of `Deno.env`. No `dotenv` package (use `deno --env`).
  - Streams: Use `@std/streams` (`TextLineStream`) for all file processing.
- Owner: Kato engineering
- Date: 2026-02-22
- Why:
  - Leverages Web Standards (Streams) and Deno native features.
  - Zod provides runtime safety for the "Launcher -> Daemon" config handoff.
- Tradeoffs:
  - None significant; standard modern Deno practice.
- Follow-up tasks:
  - Define config schema in `shared/src/contracts/config.ts`.

### Service Mode

- Decision: Defer OS service-manager integration to post-MVP (`systemd`, launchd, Windows Service).
- Owner: Kato engineering
- Date: 2026-02-22
- Why:
  - Current development/testing environment is WSL2 and does not provide a reliable systemd-capable test target.
  - Service wiring does not block the core MVP capture/export architecture.
- Tradeoffs:
  - Daemon lifecycle remains CLI-managed in MVP rather than OS-native service managed.
- Follow-up tasks:
  - Revisit service-manager integration after core daemon interfaces are stable and Linux-native test coverage is available.

### OpenFeature

- Decision: Include OpenFeature in MVP from the start.
- Owner: Kato engineering
- Date: 2026-02-22
- Why:
  - Establishes a stable feature-evaluation contract early, avoiding a second rollout later.
  - Aligns with future centralized config and cross-app policy control.
- Tradeoffs:
  - Adds up-front integration effort and a small amount of initial abstraction overhead.
- Follow-up tasks:
  - Define feature flag contract in `shared/src/contracts/config.ts`.
  - Add a local/offline provider default for MVP and keep network dependency optional.
  - Add tests for deterministic fallback behavior when remote flag providers are unavailable.
